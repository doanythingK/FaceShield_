<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:FaceShield.ViewModels.Pages"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:DataType="vm:HomePageViewModel"
             x:Class="FaceShield.Views.Pages.HomePageView">
  <Grid RowDefinitions="Auto,*" ColumnDefinitions="2*,3*"
        Margin="24" RowSpacing="16" ColumnSpacing="16">

    <!-- Header -->
    <Border Grid.Row="0" Grid.ColumnSpan="2"
            Padding="18" CornerRadius="12"
            Background="#1B1B1B">
      <StackPanel>
        <TextBlock Text="FaceShield" FontSize="28" FontWeight="Bold"/>
      </StackPanel>
    </Border>

    <!-- Left: Start -->
    <Border Grid.Row="1" Grid.Column="0"
            Padding="18" CornerRadius="12"
            Background="#151515">
      <ScrollViewer VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled">
        <StackPanel Spacing="12">

        <TextBlock Text="시작" FontSize="18" FontWeight="SemiBold"/>
        <TextBlock Text="최근 워크스페이스는 최대 5개까지 저장되며, 종료 후에도 자동 복원됩니다."
                   Opacity="0.7"
                   TextWrapping="Wrap"/>

          <Button Content="새 프로젝트 (영상 선택)"
        Height="44"
        Click="PickVideo_Click"/>

        <!--<Button Content="새 프로젝트 (영상 선택)"
                Command="{Binding PickVideoCommand}"
                Height="44"/>-->

        <!-- TODO: 기능 구현 전까지 숨김 -->
        <!--<Button Content="설정"
                Command="{Binding OpenSettingsCommand}"
                Height="40"/>

        <Button Content="정보"
                Command="{Binding OpenAboutCommand}"
                Height="40"/>-->

        <Separator Margin="0,12,0,12"/>

        <TextBlock Text="선택된 영상" Opacity="0.75"/>
        <TextBlock Text="{Binding SelectedVideoPath}"
                   TextWrapping="Wrap"
                   Opacity="0.9"/>

        <TextBlock Text="모드 선택" Margin="0,12,0,4" Opacity="0.8"/>

        <StackPanel Orientation="Horizontal" Spacing="8">
          <Button Content="자동 모자이크 하기"
                  Command="{Binding OpenAutoWorkspaceCommand}"
                  IsEnabled="{Binding CanStartWorkspace}"
                  Height="44"/>

          <Button Content="수동 모자이크 하기"
                  Command="{Binding OpenManualWorkspaceCommand}"
                  IsEnabled="{Binding CanStartWorkspace}"
                  Height="44"/>
        </StackPanel>

        <TextBlock Text="자동 옵션" Margin="0,12,0,4" Opacity="0.8"/>
        <TextBlock Text="일부 옵션은 속도가 빨라지는 대신 검출 정확도가 낮아질 수 있습니다."
                   Opacity="0.6"
                   TextWrapping="Wrap"/>

        <StackPanel Spacing="6">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="해상도 축소" Width="90" VerticalAlignment="Center"/>
            <ComboBox Width="140"
                      ItemsSource="{Binding DownscaleOptions}"
                      SelectedItem="{Binding SelectedDownscaleOption}">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}"/>
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
          </StackPanel>

          <StackPanel Orientation="Horizontal" Spacing="8">
            <CheckBox Content="추적 사용" IsChecked="{Binding AutoTrackingEnabled}"/>
            <TextBlock Text="검출 간격" VerticalAlignment="Center"/>
            <ComboBox Width="80"
                      ItemsSource="{Binding DetectEveryOptions}"
                      SelectedItem="{Binding AutoDetectEveryNFrames}"
                      IsEnabled="{Binding IsTrackingOptionsEnabled}"/>
            <TextBlock Text="프레임" VerticalAlignment="Center"/>
          </StackPanel>

          <CheckBox Content="가속(ONNX Runtime 최적화)"
                    IsChecked="{Binding AutoUseOrtOptimization}"/>
        </StackPanel>

        </StackPanel>
      </ScrollViewer>
    </Border>

    <!-- Right: Recent -->
    <Border Grid.Row="1" Grid.Column="1"
            Padding="18" CornerRadius="12"
            Background="#151515">
      <Grid RowDefinitions="Auto,*" ColumnDefinitions="*">
        <TextBlock Text="최근"
                   FontSize="18"
                   FontWeight="SemiBold"/>

        <ListBox Grid.Row="1"
                 ItemsSource="{Binding Recents}"
                 SelectedItem="{Binding SelectedRecent, Mode=TwoWay}"
                 Margin="0,12,0,0">
          <ListBox.ItemTemplate>
            <DataTemplate>
              <Border Padding="12" CornerRadius="10" Background="#1E1E1E" Margin="0,0,0,10">
                <StackPanel>
                  <TextBlock Text="{Binding Title}" FontWeight="SemiBold"/>
                  <TextBlock Text="{Binding Path}" Opacity="0.75" TextWrapping="Wrap"/>
                  <TextBlock Text="{Binding LastOpenedText}" Opacity="0.6" FontSize="12" Margin="0,6,0,0"/>
                </StackPanel>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </Grid>
    </Border>

    <!-- Loading overlay -->
    <Border Grid.Row="0" Grid.RowSpan="2" Grid.ColumnSpan="2"
            Background="#AA000000"
            IsVisible="{Binding IsBusy}">
      <Border Background="#1B1B1B" CornerRadius="12" Padding="16"
              HorizontalAlignment="Center" VerticalAlignment="Center">
        <StackPanel Spacing="8" Width="280">
          <TextBlock Text="{Binding BusyMessage}" FontSize="14"/>
          <ProgressBar Height="10" Minimum="0" Maximum="100"
                       IsIndeterminate="{Binding IsBusyIndeterminate}"
                       Value="{Binding BusyProgress}" />
          <TextBlock Text="{Binding BusyProgress, StringFormat={}{0}%}"
                     Opacity="0.8" FontSize="12" />
          <TextBlock Text="{Binding AutoEtaText}"
                     IsVisible="{Binding IsAutoRunning}"
                     Opacity="0.8" FontSize="12" />
          <Button Content="취소"
                  IsVisible="{Binding IsAutoRunning}"
                  Command="{Binding CancelAutoCommand}" />
        </StackPanel>
      </Border>
    </Border>

  </Grid>
</UserControl>
